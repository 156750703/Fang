{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/const.js","webpack:///./src/control.js","webpack:///./src/display.js","webpack:///./src/formation.js","webpack:///./src/index.js","webpack:///./src/render.js","webpack:///external \"async\""],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;ACnEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,E;;;;;;;;;;;ACzBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,wDAAwD,EAAE;AAC1D;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,eAAe;AAClC,uBAAuB,eAAe;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA,uBAAuB,yBAAyB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,uBAAuB,qBAAqB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;AAGD;;AAEA;AACA;AACA;AACA;AACA;AACA,CAAC;;;AAGD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;AC9cA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;;ACnGA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,QAAQ;AAC3B;AACA;AACA,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,QAAQ;AAC3B;AACA;AACA,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;;AAEA,2B;;;;;;;;;;;ACnJA;AACA;;AAEA;;;;;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,OAAO;AAC9B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL,eAAe;AACf;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAgB;AAChB,KAAK;AACL,gBAAgB;AAChB;AACA;;AAEA;AACA,uB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED,wB;;;;;;;;;;;AC7KA,uB","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","module.exports = {\r\n    TOPLEFT_X: 50,\r\n    TOPLEFT_Y: 50,\r\n    GRID_LENGTH: 100,\r\n    PIECE_RADIUS: 20,    \r\n\r\n    BLACK: 1,\r\n    WHITE: 2,\r\n\r\n    STAGE_READY: 0,\r\n    STAGE_OCCUPY: 1,\r\n    STAGE_CAPTURE: 2,\r\n    STAGE_MOVE: 3,\r\n    STAGE_FINISH: 4,\r\n\r\n    OPENING:0,\r\n    OCCUPY:1,    \r\n    CAPTURE:2,   \r\n    MOVE_SOURCE:3,\r\n    MOVE_TARGET:4,\r\n    MOVE_CAPTURE:5,\r\n    \r\n    COLOR_PINK:'#FF6666',\r\n    COLOR_RED:'#FF0000',\r\n    COLOR_GREEN:'#66CC99'\r\n};","var C = require('./const');\r\nvar render = require('./render');\r\nvar formation = require('./formation');\r\nvar display = require('./display');\r\nvar async = require('async');\r\n\r\nvar status = {\r\n    stage: C.STAGE_READY,\r\n    wait: C.OPENING,\r\n    availibleStep: 0,\r\n    currentColor: 0,\r\n    captureLeft: 2,\r\n    lastPosition: false,\r\n    historyFormation: [[], [], []],\r\n    watchMode: false,\r\n    winner: 0\r\n};\r\n\r\nvar board = [\r\n    0, 0, 0, 0, 0,\r\n    0, 0, 0, 0, 0,\r\n    0, 0, 0, 0, 0,\r\n    0, 0, 0, 0, 0,\r\n    0, 0, 0, 0, 0\r\n];\r\n\r\n\r\n\r\n\r\n\r\nvar control = {\r\n    handler: function (x, y) {\r\n        if (status.watchMode) {\r\n            return;\r\n        }\r\n        if (status.stage == C.STAGE_READY || status.statge == C.STAGE_FINISH) {\r\n            return;\r\n        }\r\n        if (status.availibleStep == 0) {\r\n            throw \"availible step remains 0.chess eroor!\";\r\n        }\r\n        if (status.stage === C.STAGE_OCCUPY) {\r\n            this.occupyHandler(x, y);\r\n        } else if (status.stage === C.STAGE_CAPTURE) {\r\n            this.captureHandler(x, y);\r\n        } else if (status.stage === C.STAGE_MOVE) {\r\n            this.moveHandler(x, y);\r\n        }\r\n    },\r\n    occupyHandler: function (x, y) {\r\n        var position = x + y * 5;\r\n        if (board[position]) {\r\n            return;\r\n        }\r\n\r\n        render.drawPiece(status.currentColor, x, y);\r\n        render.clearCircle();\r\n        render.drawCircle(C.COLOR_PINK, x, y);\r\n        board[x + y * 5] = status.currentColor;\r\n        status.availibleStep--;\r\n\r\n        var resultFormation = matchFormation(status.currentColor, x, y);\r\n        if (resultFormation.length > 0) {\r\n            display.displayFormations(status, resultFormation);\r\n            blinkFlow(resultFormation, handleLater);\r\n        } else {\r\n            handleLater();\r\n        }\r\n\r\n\r\n        function handleLater() {\r\n            if (isBoardFull()) {\r\n                status.stage = C.STAGE_CAPTURE;\r\n                status.wait = C.CAPTURE;\r\n                status.currentColor = status.currentColor == C.BLACK ? C.WHITE : C.BLACK;\r\n                status.availibleStep = 1;\r\n                display.displayStatus(status);\r\n            } else {\r\n\r\n                if (status.availibleStep == 0) {\r\n                    status.stage = C.STAGE_OCCUPY;\r\n                    status.wait = C.OCCUPY;\r\n                    status.currentColor = status.currentColor == C.BLACK ? C.WHITE : C.BLACK;\r\n                    status.availibleStep = 1;\r\n                }\r\n\r\n                if (resultFormation.length == 0) {\r\n                    display.displayStatus(status);\r\n                }\r\n            }\r\n        }\r\n    },\r\n    captureHandler: function (x, y) {\r\n        var position = x + y * 5;\r\n        if (board[position] == 0 || board[position] == status.currentColor) {\r\n            return;\r\n        }\r\n        render.capturePiece(x, y);\r\n        render.clearCircle();\r\n        render.drawCircle(C.COLOR_PINK, x, y);\r\n        board[position] = 0;\r\n        status.captureLeft--;\r\n        if (status.captureLeft == 1) {\r\n            status.stage = C.STAGE_CAPTURE;\r\n            status.wait = C.CAPTURE;\r\n            status.currentColor = status.currentColor == C.BLACK ? C.WHITE : C.BLACK;\r\n            status.availibleStep = 1;\r\n            display.displayStatus(status);\r\n        } else {\r\n            var oppsiteColor = status.currentColor == C.BLACK ? C.WHITE : C.BLACK;\r\n            if (canMoveStep(oppsiteColor) == 0) {\r\n                status.winner = status.currentColor;\r\n                buildfinishState();\r\n                display.dispalyCannotMove(status);\r\n            } else {\r\n                status.stage = C.STAGE_MOVE;\r\n                status.wait = C.MOVE_SOURCE;\r\n                status.currentColor = status.currentColor == C.BLACK ? C.WHITE : C.BLACK;\r\n                status.availibleStep = 1;\r\n                display.displayStatus(status);\r\n            }\r\n        }\r\n       \r\n    },\r\n    moveHandler: function (x, y) {\r\n        var position = x + y * 5;\r\n\r\n        if (status.wait == C.MOVE_SOURCE) {\r\n            if (board[position] != status.currentColor) {\r\n                return;\r\n            }\r\n            status.lastPosition = [x, y];\r\n\r\n            render.clearCircle();\r\n            render.drawCircle(C.COLOR_PINK, x, y);\r\n\r\n            status.wait = C.MOVE_TARGET;\r\n        } else if (status.wait == C.MOVE_TARGET) {\r\n            if (isArrayEqual([x, y], status.lastPosition)) {\r\n                render.clearCircle();\r\n                status.stage = C.STAGE_MOVE;\r\n                status.wait = C.MOVE_SOURCE;\r\n                return;\r\n            }\r\n            if (board[position] != 0) {\r\n                return;\r\n            }\r\n            var lastPos = status.lastPosition[0] + 5 * status.lastPosition[1];\r\n            var gap = Math.abs(position - lastPos);\r\n            if (gap != 1 && gap != 5) {\r\n                return;\r\n            }\r\n            render.capturePiece(status.lastPosition[0], status.lastPosition[1]);\r\n            render.drawPiece(status.currentColor, x, y);\r\n            render.clearCircle();\r\n            render.drawCircle(C.COLOR_GREEN, status.lastPosition[0], status.lastPosition[1]);\r\n            render.drawCircle(C.COLOR_PINK, x, y);\r\n            status.availibleStep--;\r\n            status.lastPosition = [x, y];\r\n            board[lastPos] = 0;\r\n            board[position] = status.currentColor;\r\n\r\n            var resultFormation = matchFormation(status.currentColor, x, y);\r\n\r\n            var hisArr = status.historyFormation[status.currentColor];\r\n            var hisObj = {\r\n                location: [x, y],\r\n                formation: resultFormation\r\n            };\r\n\r\n            if (resultFormation.length > 0) {\r\n                if (hisArr.length >= 2 && isSameHistory(hisObj, hisArr[1])) {\r\n                    display.displayInfo(status, '不能重复在同一位置成同一种型');\r\n                } else {\r\n                    hisArr.unshift(hisObj = {\r\n                        location: [x, y],\r\n                        formation: resultFormation\r\n                    });\r\n                }\r\n            }\r\n\r\n            if (status.availibleStep == 0) {\r\n                var oppsiteColor = status.currentColor == C.BLACK ? C.WHITE : C.BLACK;\r\n                if (canMoveStep(oppsiteColor) == 0) {\r\n                    status.winner = status.currentColor;\r\n                    buildfinishState();\r\n                    display.dispalyCannotMove(status);\r\n                } else {\r\n                    status.stage = C.STAGE_MOVE;\r\n                    status.wait = C.MOVE_SOURCE;\r\n                    status.currentColor = status.currentColor == C.BLACK ? C.WHITE : C.BLACK;\r\n                    status.availibleStep = 1;\r\n                    display.displayStatus(status);\r\n                }\r\n            } else {\r\n                status.stage = C.STAGE_MOVE;\r\n                status.wait = C.MOVE_CAPTURE;\r\n                display.displayFormations(status, resultFormation);\r\n                blinkFlow(resultFormation, function () { });\r\n            }\r\n        } else if (status.wait == C.MOVE_CAPTURE) {\r\n            var oppsiteColor = status.currentColor == C.BLACK ? C.WHITE : C.BLACK;\r\n            if (board[position] != oppsiteColor) {\r\n                return;\r\n            }\r\n            status.availibleStep--;\r\n            render.capturePiece(x, y);\r\n            render.clearCircle();\r\n            render.drawCircle(C.COLOR_PINK, x, y);\r\n            board[position] = 0;\r\n            if (getEmptyWinner() != 0) {\r\n                status.winner = getEmptyWinner();\r\n                buildfinishState();\r\n                display.displayStatus(status);\r\n            } else if (status.availibleStep == 0) {\r\n                var oppsiteColor = status.currentColor == C.BLACK ? C.WHITE : C.BLACK;\r\n                if (canMoveStep(oppsiteColor) == 0) {\r\n                    status.winner = status.currentColor;\r\n                    buildfinishState();\r\n                    display.dispalyCannotMove(status);\r\n                } else {\r\n                    status.stage = C.STAGE_MOVE;\r\n                    status.wait = C.MOVE_SOURCE;\r\n                    status.currentColor = status.currentColor == C.BLACK ? C.WHITE : C.BLACK;\r\n                    status.availibleStep = 1;\r\n                    display.displayStatus(status);\r\n                }\r\n            }\r\n           \r\n        }\r\n    }\r\n};\r\n\r\n\r\nfunction buildfinishState() {\r\n    document.getElementById('btnTerminate').style.display = 'none';\r\n    document.getElementById('btnStart').style.display = '';\r\n    //status.winner = getWinner();\r\n    status.stage = C.STAGE_FINISH;\r\n    status.wait = C.OPENING;\r\n    status.availibleStep = 0;\r\n    status.captureLeft = 2;\r\n    board = [\r\n        0, 0, 0, 0, 0,\r\n        0, 0, 0, 0, 0,\r\n        0, 0, 0, 0, 0,\r\n        0, 0, 0, 0, 0,\r\n        0, 0, 0, 0, 0\r\n    ];\r\n}\r\n\r\nfunction canMoveStep(color) {\r\n    var stepCount = 0;\r\n    for (var i = 0; i < board.length; i++) {\r\n        if (board[i] == color) {\r\n            var x = i% 5;\r\n            var y = Math.floor(i / 5);\r\n            if (x != 0 && board[i - 1] == 0) {\r\n                stepCount++;\r\n            }\r\n            if (x != 4 && board[i + 1] == 0) {\r\n                stepCount++;\r\n            }\r\n            if (y != 0 && board[i - 5] == 0) {\r\n                stepCount++;\r\n            }\r\n            if (y != 4 && board[i + 5] == 0) {\r\n                stepCount++;\r\n            }\r\n        }\r\n    }\r\n    return stepCount;\r\n}\r\n\r\nfunction isSameHistory(h1, h2) {\r\n    if (!isArrayEqual(h1.location, h2.location)) {\r\n        return;\r\n    }\r\n    var f1 = flatten(h1.formation);\r\n    var f2 = flatten(h2.formation);\r\n    var sum = 0;\r\n    for (var i = 0; i < f1.length; i++) {\r\n        for (var j = 0; j < f2.length; j++) {\r\n            if (isArrayEqual(f1[i], f2[j])) {\r\n                sum++;\r\n            }\r\n        }\r\n    }\r\n    if (sum > 0) {\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction flatten(arr) {\r\n    var nArr = [], i = 0;\r\n    do {\r\n        nArr = nArr.concat(arr[i]);\r\n    } while (++i < arr.length)\r\n    return nArr;\r\n}\r\n\r\nfunction isArrayEqual(arr1, arr2) {\r\n    if (arr1.length != arr2.length) {\r\n        return;\r\n    }\r\n    for (var i = 0; i < arr1.length; i++) {\r\n        if (arr1[i] != arr2[i]) {\r\n            break;\r\n        }\r\n    }\r\n    if (i == arr1.length) {\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction matchFormation(color, x, y, endCallback) {\r\n    var position = x + y * 5;\r\n    var resultFormation = [];\r\n\r\n    var resultTong = formation.matchTong(board, color, position);\r\n    if (resultTong.length) {\r\n        status.availibleStep += resultTong.length * 3;\r\n        resultFormation.push(resultTong);\r\n    }\r\n    var resultXie4 = formation.matchXie4(board, color, position);\r\n    if (resultXie4.length) {\r\n        status.availibleStep += resultXie4.length * 2;\r\n        resultFormation.push(resultXie4);\r\n    }\r\n    var resultXie = formation.matchXie(board, color, position);\r\n    if (resultXie.length) {\r\n        status.availibleStep += resultXie.length * 1;\r\n        resultFormation.push(resultXie);\r\n    }\r\n    var resultFang = formation.matchFang(board, color, position);\r\n    if (resultFang.length) {\r\n        status.availibleStep += resultFang.length * 1;\r\n        resultFormation.push(resultFang);\r\n    }\r\n    var resultPilin = formation.matchPilin(board, color, position);\r\n    if (resultPilin.length) {\r\n        status.availibleStep += resultPilin.length * 2;\r\n        resultFormation.push(resultPilin);\r\n    }\r\n    return resultFormation;\r\n}\r\n\r\nfunction blinkFlow(formations, endCallback) {\r\n    status.watchMode = true;\r\n    formations = flatten(formations);\r\n    var tasks = formations.map(function (f) {\r\n        return function (callback) {\r\n            blink(f, callback)\r\n        }\r\n    });\r\n    async.waterfall(tasks, function (err, result) {\r\n        status.watchMode = false;\r\n        endCallback();\r\n    })\r\n}\r\n\r\nfunction blink(formation, callback) {\r\n    var i = 0;\r\n    var handler = setInterval(function () {\r\n        if (i % 2 == 0) {\r\n            hlFormation(formation);\r\n        } else {\r\n            render.rmHighlight();\r\n        }\r\n        if (i == 3) {\r\n            clearInterval(handler);\r\n            callback()\r\n        }\r\n        i++;\r\n    }, 300)\r\n}\r\n\r\nfunction hlFormation(formation) {\r\n    var position = formation.position;\r\n    if (['tong', 'xie4', 'xie', 'pilin'].indexOf(formation.type) > -1) {\r\n\r\n        for (var i = 0; i < position.length - 1; i++) {\r\n            var x1 = position[i] % 5;\r\n            var y1 = Math.floor(position[i] / 5);\r\n            var x2 = position[i + 1] % 5;\r\n            var y2 = Math.floor(position[i + 1] / 5);\r\n            render.highlight([x1, y1], [x2, y2]);\r\n        }\r\n    } else if (formation.type == 'fang') {\r\n        for (var i = 0; i < position.length; i++) {\r\n            if (i < position.length - 1) {\r\n                var x1 = position[i] % 5;\r\n                var y1 = Math.floor(position[i] / 5);\r\n                var x2 = position[i + 1] % 5;\r\n                var y2 = Math.floor(position[i + 1] / 5);\r\n                render.highlight([x1, y1], [x2, y2]);\r\n            } else {\r\n                var x1 = position[i] % 5;\r\n                var y1 = Math.floor(position[i] / 5);\r\n                var x2 = position[0] % 5;\r\n                var y2 = Math.floor(position[0] / 5);\r\n                render.highlight([x1, y1], [x2, y2]);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\ndocument.getElementById('btnStart').addEventListener('click', function () {\r\n    this.style.display = 'none';\r\n    document.getElementById('btnTerminate').style.display = '';\r\n    status.stage = C.STAGE_OCCUPY;\r\n    status.wait = C.OCCUPY;\r\n    status.currentColor = C.BLACK;\r\n    status.availibleStep = 1;\r\n    render.clearBoard();\r\n    render.clearCircle();\r\n    display.displayStatus(status);\r\n});\r\n\r\ndocument.getElementById('btnTerminate').addEventListener('click', function () {\r\n    this.style.display = 'none';\r\n    document.getElementById('btnStart').style.display = '';\r\n    status.stage = C.STAGE_FINISH;\r\n    status.wait = C.OPENING;\r\n    status.availibleStep = 0;\r\n    status.captureLeft = 2;\r\n    board = [\r\n        0, 0, 0, 0, 0,\r\n        0, 0, 0, 0, 0,\r\n        0, 0, 0, 0, 0,\r\n        0, 0, 0, 0, 0,\r\n        0, 0, 0, 0, 0\r\n    ];\r\n    display.displayStatus(status);\r\n});\r\n\r\n\r\ndisplay.displayStatus(status);\r\n\r\nrender.bind('click.control', function (evt) {\r\n    //console.log(evt.GridX, evt.GridY);\r\n    var x = evt.GridX;\r\n    var y = evt.GridY;\r\n    control.handler(x, y);\r\n});\r\n\r\n\r\nfunction isBoardFull() {\r\n    return board.indexOf(0) < 0;\r\n}\r\n\r\nfunction getEmptyWinner() {\r\n    if (board.indexOf(C.BLACK) < 0) {\r\n        return C.WHITE;\r\n    }\r\n    if (board.indexOf(C.WHITE) < 0) {\r\n        return C.BLACK;\r\n    }\r\n    return 0;\r\n}\r\n\r\nmodule.exports = control;\r\n","var C = require('./const');\r\nvar infoArea = document.getElementById('infoArea');\r\n\r\nfunction getStatusInfo(status) {\r\n    var info = '', color = '';\r\n    if (status.currentColor == C.BLACK) {\r\n        color = '黑方';\r\n    } else if (status.currentColor == C.WHITE) {\r\n        color = '白方';\r\n    }\r\n\r\n    if (status.stage == C.STAGE_READY) {\r\n        info += '请开局';\r\n    }\r\n    if (status.stage == C.STAGE_OCCUPY) {\r\n        info += '落子阶段：' + color + '落子，剩余' + status.availibleStep + '步可落';\r\n    }\r\n    if (status.stage == C.STAGE_CAPTURE) {\r\n        info += '吃子阶段：' + color + '吃子，剩余' + status.availibleStep + '子可吃';\r\n    }\r\n    if (status.stage == C.STAGE_MOVE) {\r\n        if ([C.MOVE_SOURCE, C.MOVE_TARGET].indexOf(status.wait) > -1) {\r\n            info += '走子阶段：' + color + '走子，剩余1步可走';\r\n        }\r\n        if (status.wait == C.MOVE_CAPTURE) {\r\n            info += '走子阶段：' + color + '吃子，剩余' + status.availibleStep + '子可吃';\r\n        }\r\n    }\r\n    if (status.stage == C.STAGE_FINISH) {\r\n        var winColor = '';\r\n        if (status.winner == C.BLACK) {\r\n            winColor = '黑方';\r\n        } else if (status.winner == C.WHITE) {\r\n            winColor = '白方';\r\n        }\r\n        if (winColor) {\r\n            info += '已结束。赢者：' + winColor;\r\n        }\r\n    }\r\n    return info;\r\n}\r\n\r\nfunction getFormationInfo(results) {\r\n    var info = '';\r\n    var color = '';\r\n    if (results[0].color == C.BLACK) {\r\n        color = '黑方';\r\n    } else if (results[0].color == C.WHITE) {\r\n        color = '白方';\r\n    }\r\n\r\n    if (results[0].type == 'tong') {\r\n        info += color + '成' + results.length + '个五通棋型，加' + results.length * 3 + '步';\r\n    }\r\n    if (results[0].type == 'xie4') {\r\n        info += color + '成' + results.length + '个四斜棋型，加' + results.length * 2 + '步';\r\n    }\r\n    if (results[0].type == 'xie') {\r\n        info += color + '成' + results.length + '个斜棋型，加' + results.length * 1 + '步';\r\n    }\r\n    if (results[0].type == 'fang') {\r\n        info += color + '成' + results.length + '个方棋型，加' + results.length * 1 + '步';\r\n    }\r\n    if (results[0].type == 'pilin') {\r\n        info += color + '成' + results.length + '个匹林棋型，加' + results.length * 2 + '步';\r\n    }\r\n    return info;\r\n}\r\n\r\nfunction displayStatus(status) {\r\n    infoArea.innerHTML = getStatusInfo(status);\r\n}\r\n\r\nfunction displayFormations(status, formations) {\r\n    var info = formations.map(function (f) {\r\n        return getFormationInfo(f);\r\n    }).join('<br>');\r\n    infoArea.innerHTML = info + '<br>' + getStatusInfo(status);\r\n}\r\n\r\nfunction dispalyCannotMove(status) {\r\n    var info='',looserColor = '';\r\n    if (status.winner == C.BLACK) {\r\n        looserColor = '白方';\r\n    } else if (status.winner == C.WHITE) {\r\n        looserColor = '黑方';\r\n    }\r\n    info+=looserColor + '无法移动';\r\n    infoArea.innerHTML = info + '<br>' + getStatusInfo(status);\r\n}\r\n\r\nfunction displayInfo(status, info) {\r\n    infoArea.innerHTML = info + '<br>' + getStatusInfo(status);\r\n}\r\n\r\nmodule.exports = {\r\n    displayInfo: displayInfo,\r\n    displayStatus: displayStatus,\r\n    displayFormations: displayFormations,\r\n    dispalyCannotMove:dispalyCannotMove\r\n}","\r\nvar board = [\r\n    0/*00*/, 0/*01*/, 0/*02*/, 0/*03*/, 0/*04*/,\r\n\r\n    0/*05*/, 0/*06*/, 0/*07*/, 0/*08*/, 0/*09*/,\r\n\r\n    0/*10*/, 0/*11*/, 0/*12*/, 0/*13*/, 0/*14*/,\r\n\r\n    0/*15*/, 0/*16*/, 0/*17*/, 0/*18*/, 0/*19*/,\r\n\r\n    0/*20*/, 0/*21*/, 0/*22*/, 0/*23*/, 0/*24*/\r\n];\r\n\r\nvar formation = {\r\n    tong: [[0, 6, 12, 18, 24], [4, 8, 12, 16, 20]],\r\n    xie4: [[3, 7, 11, 15], [1, 7, 13, 19], [5, 11, 17, 23], [9, 13, 17, 21]],\r\n    xie: [[2, 6, 10], [2, 8, 14], [10, 16, 22], [14, 18, 22]],\r\n    fang: [\r\n        [0, 1, 6, 5], [1, 2, 7, 6], [2, 3, 8, 7], [3, 4, 9, 8],\r\n        [5, 6, 11, 10], [6, 7, 12, 11], [7, 8, 13, 12], [8, 9, 14, 13],\r\n        [10, 11, 16, 15], [11, 12, 17, 16], [12, 13, 18, 17], [13, 14, 19, 18],\r\n        [15, 16, 21, 20], [16, 17, 22, 21], [17, 18, 23, 22], [18, 19, 24, 23]\r\n    ],\r\n    pilin: [\r\n        [0, 1, 2, 3, 4], [5, 6, 7, 8, 9], [10, 11, 12, 13, 14], [15, 16, 17, 18, 19], [20, 21, 22, 23, 24],\r\n        [0, 5, 10, 15, 20], [1, 6, 11, 16, 21], [2, 7, 12, 17, 22], [3, 8, 13, 18, 23], [4, 9, 14, 19, 24]\r\n    ],\r\n    matchTong: matchTong,\r\n    matchXie4: matchXie4,\r\n    matchXie: matchXie,\r\n    matchFang: matchFang,\r\n    matchPilin: matchPilin\r\n}\r\n\r\n\r\nfunction matchTong(combatBoard, color, position) {\r\n    var result = [];\r\n    for (var i = 0; i < 2; i++) {\r\n        var formation_tong = formation.tong[i];\r\n        if (formation_tong.indexOf(position) > -1) {\r\n            for (var j = 0; j < 5; j++) {\r\n                if (combatBoard[formation_tong[j]] != color) {\r\n                    break;\r\n                }\r\n            }\r\n            if (j == 5) {\r\n                result.push({\r\n                    type: 'tong',\r\n                    color: color,\r\n                    position: formation_tong.slice(0)\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction matchXie4(combatBoard, color, position) {\r\n    var result = [];\r\n    for (var i = 0; i < 4; i++) {\r\n        var formation_xie4 = formation.xie4[i];\r\n        if (formation_xie4.indexOf(position) > -1) {\r\n            for (var j = 0; j < 4; j++) {\r\n                if (combatBoard[formation_xie4[j]] != color) {\r\n                    break;\r\n                }\r\n            }\r\n            if (j == 4) {\r\n                result.push({\r\n                    type: 'xie4',\r\n                    color: color,\r\n                    position: formation_xie4.slice(0)\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction matchXie(combatBoard, color, position) {\r\n    var result = [];\r\n    for (var i = 0; i < 4; i++) {\r\n        var formation_xie = formation.xie[i];\r\n        if (formation_xie.indexOf(position) > -1) {\r\n            for (var j = 0; j < 3; j++) {\r\n                if (combatBoard[formation_xie[j]] != color) {\r\n                    break;\r\n                }\r\n            }\r\n            if (j == 3) {\r\n                result.push({\r\n                    type: 'xie',\r\n                    color: color,\r\n                    position: formation_xie.slice(0)\r\n                })\r\n            }\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nfunction matchFang(combatBoard, color, position) {\r\n    var result = [];\r\n    for (var i = 0; i < 16; i++) {\r\n        var formation_fang = formation.fang[i];\r\n        if (formation_fang.indexOf(position) > -1) {\r\n            for (var j = 0; j < 4; j++) {\r\n                if (combatBoard[formation_fang[j]] != color) {\r\n                    break;\r\n                }\r\n            }\r\n            if (j == 4) {\r\n                result.push({\r\n                    type: 'fang',\r\n                    color: color,\r\n                    position: formation_fang.slice(0)\r\n                })\r\n            }\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nfunction matchPilin(combatBoard, color, position) {\r\n    var result = [];\r\n    for (var i = 0; i < 10; i++) {\r\n        var formation_pilin = formation.pilin[i];\r\n        if (formation_pilin.indexOf(position) > -1) {\r\n            for (var j = 0; j < 5; j++) {\r\n                if (combatBoard[formation_pilin[j]] != color) {\r\n                    break;\r\n                }\r\n            }\r\n            if (j == 5) {\r\n                result.push({\r\n                    type: 'pilin',\r\n                    color: color,\r\n                    position: formation_pilin.slice(0)\r\n                })\r\n            }\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nmodule.exports = formation;","var  render = require('./render');\r\nvar control = require('./control');\r\n\r\nrender.drawBoard();\r\n","var C = require('./const');\r\nvar boardCanvas = document.getElementById(\"board\");\r\nvar boardCtx = boardCanvas.getContext('2d');\r\nvar selectedCanvas = document.getElementById(\"selected\");\r\nvar selectedCtx = selectedCanvas.getContext('2d');\r\nvar highlightCanvas = document.getElementById(\"highlight\");\r\nvar highlightCtx = highlightCanvas.getContext('2d');\r\n\r\nvar render = {\r\n    drawBoard: function drawBoard() {\r\n        var rightBottom = {\r\n            X: C.TOPLEFT_X + C.GRID_LENGTH * 4,\r\n            Y: C.TOPLEFT_Y + C.GRID_LENGTH * 4,\r\n        };\r\n\r\n        boardCtx.beginPath();\r\n        for (var i = 0; i < 5; i++) {\r\n            boardCtx.moveTo(C.TOPLEFT_X, C.TOPLEFT_Y + i * C.GRID_LENGTH);\r\n            boardCtx.lineTo(rightBottom.X, C.TOPLEFT_Y + i * C.GRID_LENGTH);\r\n\r\n            boardCtx.moveTo(C.TOPLEFT_X + i * C.GRID_LENGTH, C.TOPLEFT_Y);\r\n            boardCtx.lineTo(C.TOPLEFT_X + i * C.GRID_LENGTH, rightBottom.Y);\r\n        }\r\n        boardCtx.closePath();\r\n        boardCtx.lineWidth = 1;\r\n        boardCtx.stroke();\r\n    },\r\n    drawPiece: function drawPiece(type, m, n) {\r\n        var targetX = C.TOPLEFT_X + m * C.GRID_LENGTH;\r\n        var targetY = C.TOPLEFT_Y + n * C.GRID_LENGTH;\r\n\r\n        boardCtx.clearRect(targetX - C.PIECE_RADIUS, targetY - C.PIECE_RADIUS, 2 * C.PIECE_RADIUS, 2 * C.PIECE_RADIUS);\r\n        boardCtx.beginPath();\r\n        boardCtx.arc(targetX, targetY, C.PIECE_RADIUS, 0, Math.PI * 2);\r\n        boardCtx.closePath();\r\n        if (type == C.WHITE) {\r\n            boardCtx.stroke();\r\n        } else {\r\n            boardCtx.fill();\r\n        }\r\n    },\r\n    drawCircle: function (color, m, n) {\r\n        var targetX = C.TOPLEFT_X + m * C.GRID_LENGTH;\r\n        var targetY = C.TOPLEFT_Y + n * C.GRID_LENGTH;\r\n        selectedCtx.beginPath();\r\n        selectedCtx.arc(targetX, targetY, C.PIECE_RADIUS + 5, 0, Math.PI * 2);\r\n        selectedCtx.closePath();\r\n\r\n        selectedCtx.strokeStyle = color;\r\n        selectedCtx.lineWidth = 2;\r\n        selectedCtx.stroke();\r\n    },\r\n    clearCircle: function () {\r\n        selectedCtx.clearRect(0, 0, 500, 500);\r\n    },\r\n    clearBoard: function () {\r\n        boardCtx.clearRect(0, 0, 500, 500);\r\n        this.drawBoard();\r\n    },\r\n    capturePiece: function (m, n) {\r\n        var targetX = C.TOPLEFT_X + m * C.GRID_LENGTH;\r\n        var targetY = C.TOPLEFT_Y + n * C.GRID_LENGTH;\r\n        var clearLength = C.GRID_LENGTH / 2;\r\n\r\n        boardCtx.clearRect(targetX - clearLength, targetY - clearLength, 2 * clearLength, 2 * clearLength);\r\n        boardCtx.beginPath();\r\n\r\n\r\n        if (m != 0) {\r\n            boardCtx.moveTo(targetX - clearLength, targetY)\r\n            boardCtx.lineTo(targetX, targetY);\r\n        }\r\n        if (m != 4) {\r\n            boardCtx.moveTo(targetX + clearLength, targetY)\r\n            boardCtx.lineTo(targetX, targetY);\r\n        }\r\n        if (n != 0) {\r\n            boardCtx.moveTo(targetX, targetY - clearLength)\r\n            boardCtx.lineTo(targetX, targetY);\r\n        }\r\n        if (n != 4) {\r\n            boardCtx.moveTo(targetX, targetY + clearLength)\r\n            boardCtx.lineTo(targetX, targetY);\r\n        }\r\n\r\n        boardCtx.moveTo(0, 0);\r\n        boardCtx.lineTo(0, 0);\r\n\r\n        boardCtx.closePath();\r\n        boardCtx.lineWidth = 1;\r\n        boardCtx.stroke();\r\n    },\r\n    highlight: function (p1, p2) {\r\n        var temp = reArrenge(p1, p2);\r\n        p1 = temp.p1, p2 = temp.p2;\r\n        var x1 = p1[0], y1 = p1[1], x2 = p2[0], y2 = p2[1];\r\n        var srcX, srcY, targetX, targetY;\r\n        highlightCtx.beginPath();\r\n        if (x1 != x2 && y1 == y2) {\r\n            srcX = C.TOPLEFT_X + x1 * C.GRID_LENGTH + C.PIECE_RADIUS;\r\n            srcY = C.TOPLEFT_Y + y1 * C.GRID_LENGTH;\r\n            targetX = C.TOPLEFT_X + x2 * C.GRID_LENGTH - C.PIECE_RADIUS;\r\n            targetY = C.TOPLEFT_Y + y2 * C.GRID_LENGTH;\r\n            highlightCtx.moveTo(srcX, srcY);\r\n            highlightCtx.lineTo(targetX, targetY);\r\n        }\r\n        if (x1 == x2 && y1 != y2) {\r\n            srcX = C.TOPLEFT_X + x1 * C.GRID_LENGTH;\r\n            srcY = C.TOPLEFT_Y + y1 * C.GRID_LENGTH + C.PIECE_RADIUS;\r\n            targetX = C.TOPLEFT_X + x2 * C.GRID_LENGTH;\r\n            targetY = C.TOPLEFT_Y + y2 * C.GRID_LENGTH - C.PIECE_RADIUS;\r\n            highlightCtx.moveTo(srcX, srcY);\r\n            highlightCtx.lineTo(targetX, targetY);\r\n        }\r\n        if (x1 != x2 && y1 != y2) {\r\n            if (x1 < x2) {\r\n                srcX = C.TOPLEFT_X + x1 * C.GRID_LENGTH + C.PIECE_RADIUS * Math.SQRT1_2;\r\n                srcY = C.TOPLEFT_Y + y1 * C.GRID_LENGTH + C.PIECE_RADIUS * Math.SQRT1_2;\r\n                targetX = C.TOPLEFT_X + x2 * C.GRID_LENGTH - C.PIECE_RADIUS * Math.SQRT1_2;\r\n                targetY = C.TOPLEFT_Y + y2 * C.GRID_LENGTH - C.PIECE_RADIUS * Math.SQRT1_2;\r\n            }else if( x1 > x2){\r\n                srcX = C.TOPLEFT_X + x1 * C.GRID_LENGTH - C.PIECE_RADIUS * Math.SQRT1_2;\r\n                srcY = C.TOPLEFT_Y + y1 * C.GRID_LENGTH + C.PIECE_RADIUS * Math.SQRT1_2;\r\n                targetX = C.TOPLEFT_X + x2 * C.GRID_LENGTH + C.PIECE_RADIUS * Math.SQRT1_2;\r\n                targetY = C.TOPLEFT_Y + y2 * C.GRID_LENGTH - C.PIECE_RADIUS * Math.SQRT1_2;\r\n            }\r\n\r\n            highlightCtx.moveTo(srcX, srcY);\r\n            highlightCtx.lineTo(targetX, targetY);\r\n        }\r\n        highlightCtx.closePath();\r\n        highlightCtx.strokeStyle = C.COLOR_RED;\r\n        highlightCtx.lineWidth = 4;\r\n        highlightCtx.stroke();\r\n    },\r\n    rmHighlight: function () {\r\n        highlightCtx.clearRect(0, 0, 500, 500);\r\n    },\r\n    evtList: {},\r\n    bind: function (id, func) {\r\n        this.evtList[id] = func;\r\n    }\r\n};\r\n\r\nfunction reArrenge(p1, p2) {\r\n    var pos1 = p1[0] + 5 * p1[1];\r\n    var pos2 = p2[0] + 5 * p2[1];\r\n    if (pos1 < pos2) {\r\n        return { p1: p1, p2: p2 };\r\n    } else {\r\n        return { p1: p2, p2: p1 };\r\n    }\r\n}\r\n\r\nboardCanvas.addEventListener('click', function (evt) {\r\n    //console.log(evt);    \r\n    var offsetX = evt.offsetX;\r\n    var offsetY = evt.offsetY;\r\n\r\n    var validX = Math.abs(offsetX % C.GRID_LENGTH - C.TOPLEFT_X) <= C.PIECE_RADIUS;\r\n    var validY = Math.abs(offsetY % C.GRID_LENGTH - C.TOPLEFT_Y) <= C.PIECE_RADIUS;\r\n    if (validX && validY) {\r\n        var m = Math.floor(offsetX / C.GRID_LENGTH);\r\n        var n = Math.floor(offsetY / C.GRID_LENGTH);\r\n        evt.GridX = m;\r\n        evt.GridY = n;\r\n        //console.log(m, n);\r\n        for (var funId in render.evtList) {\r\n            render.evtList[funId](evt);\r\n        }\r\n    }\r\n});\r\n\r\nmodule.exports = render;","module.exports = async;"],"sourceRoot":""}